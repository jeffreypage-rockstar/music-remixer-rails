<!-- Part Details Area Start -->
<ul id="part-info">
    <li><p>Part Configuration</p></li>
    <% @part = @song.parts.first%>
    <li class="name-editor" type="part">
        <span class="name" data-name="<%= @part.name %>" title="Click to edit...">Name: <%= @part.name %></span>
        <div class="edit"> 
            <%= form_for([@song, @part], :remote => true, method: :put) do |f| %>
                <label for="part_name">Name:</label>
                <%= f.text_field :name, required: true, maxlength: 10 %>
            <% end %>
        </div>
    </li>
    <li><p id="part-time">Time: <%= Time.at(@part.duration).utc.strftime("%M:%S") %></p></li>
</ul>
<script type="text/javascript">
    function updatePartName(column, event, name) {
        $("#part-info .name-editor > .name")
            .text("Name: "+$(event.target).val())
            .attr('data-name',$(event.target).val());

        $("#clips-"+column).children(".level.column")
            .attr('data-name', name)
            .text(name);
    }

    $(document).ready(function(){
        $("#part-info .name-editor > .name").click(function(event){
            event.stopPropagation();
            $(event.target).parent().addClass('editing');
            $(event.target).parents('.name-editor').find('input').focus().val($(event.target).attr('data-name'))
        });

        $("#part-info .name-editor input[type='text']").on('keypress',function(event){
            if (event.keyCode == 13) { event.target.blur(); };
        });

        $('form').on('submit', function(){
            return false;
        });

        $("#part-info .name-editor input[type='text']").on('blur',function(event){
            event.stopPropagation();
            $(event.target).parents('.name-editor').removeClass('editing');
            if ($.trim($(event.target).val()) == "") {
                return alert("Name can not be empty.");
            };

            // Update part name
            var column = index;
            updatePartName(column, event, $(event.target).val());
            $.ajax({
                type: "PUT",
                dataType: "json",
                url: $(event.target).parent().attr('action'),
                contentType: 'application/json',
                data: JSON.stringify({name: $(event.target).val() })
            }).done(function(part){
                // if (part && part.name) {
                    // updatePartName(column, event, part.name);    
                // };
            }); 
        });
    });
</script>
<!-- Part Details Area Start -->